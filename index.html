<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Fighting Game Prototype</title>
    <style>
        body {
            margin: 0;
            background-color: #202020;
            display: flex;
            justify_content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: 'Courier New', Courier, monospace;
        }
        canvas {
            background-color: #444; /* Warna background stage */
            border: 4px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #ui-layer {
            position: absolute;
            top: 20px;
            width: 1024px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            pointer-events: none;
        }
        .health-bar {
            width: 400px;
            height: 30px;
            background: #555;
            border: 2px solid #fff;
            position: relative;
        }
        .health-fill {
            height: 100%;
            background: yellow; /* Player P1 */
            width: 100%;
            transition: width 0.2s;
        }
        #enemy-health .health-fill {
            background: red; /* Enemy AI */
            float: right; /* Berkurang dari kiri ke kanan */
        }
    </style>
</head>
<body>

    <div id="ui-layer" style="display: none;">
        <div class="health-bar" id="p1-health"><div class="health-fill" id="p1-fill"></div></div>
        <div class="health-bar" id="enemy-health"><div class="health-fill" id="enemy-fill"></div></div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    // --- KONFIGURASI UMUM ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Set Ukuran Layar Game (HD Ready 16:9)
    canvas.width = 1024;
    canvas.height = 576;

    // SPESIFIKASI SPRITE KAMU
    const SPRITE_WIDTH = 128;
    const SPRITE_HEIGHT = 150;
    
    // Physics
    const GRAVITY = 0.7;
    const GROUND_Y = canvas.height - 100; // Posisi tanah

    // Game State
    let gameState = 'MENU'; // MENU, PLAY, GAMEOVER
    let winner = '';

    // --- CLASS FIGHTER ---
    class Fighter {
        constructor({position, velocity, color, isEnemy = false}) {
            this.position = position;
            this.velocity = velocity;
            this.width = 50;  // Lebar Hitbox (bukan lebar gambar)
            this.height = 150; // Tinggi Hitbox (sesuai tinggi sprite kamu)
            this.color = color;
            this.isEnemy = isEnemy;
            this.lastKey;
            
            // Status Combat
            this.health = 100;
            this.isAttacking = false;
            this.attackType = ''; // 'punch' atau 'kick'
            
            // Attack Box (Area serang)
            this.attackBox = {
                position: { x: this.position.x, y: this.position.y },
                offset: { x: 0, y: 0 }, // Jarak serangan dari badan
                width: 100,
                height: 50
            };
            
            // Arah hadap (1 = kanan, -1 = kiri)
            this.facing = isEnemy ? -1 : 1; 
        }

        draw() {
            // --- GANTI BAGIAN INI DENGAN SPRITE KAMU NANTI ---
            // Placeholder: Gambar Kotak Badan
            ctx.fillStyle = this.color;
            ctx.fillRect(this.position.x, this.position.y, this.width, this.height);

            // Placeholder: Gambar Attack Box (Kalau sedang nyerang)
            if (this.isAttacking) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)'; // Putih transparan
                
                // Atur posisi attack box berdasarkan arah hadap
                let attackX = this.facing === 1 
                    ? this.position.x + this.width 
                    : this.position.x - this.attackBox.width;

                ctx.fillRect(
                    attackX, 
                    this.attackBox.position.y, 
                    this.attackBox.width, 
                    this.attackBox.height
                );
            }
            // -------------------------------------------------
        }

        update() {
            this.draw();
            
            // Attack Box mengikuti badan
            this.attackBox.position.y = this.position.y + 20; // Tinggi serangan (dada)

            // Physics Posisi
            this.position.x += this.velocity.x;
            this.position.y += this.velocity.y;

            // Gravity
            if (this.position.y + this.height + this.velocity.y >= GROUND_Y) {
                this.velocity.y = 0;
                this.position.y = GROUND_Y - this.height; // Mentok tanah
            } else {
                this.velocity.y += GRAVITY;
            }

            // Batas Layar
            if (this.position.x < 0) this.position.x = 0;
            if (this.position.x + this.width > canvas.width) this.position.x = canvas.width - this.width;
        }

        attack(type) {
            if (this.isAttacking) return; // Jangan spam tombol
            
            this.isAttacking = true;
            this.attackType = type;
            
            // Atur Hitbox serangan berdasarkan tipe
            if (type === 'punch') {
                this.attackBox.height = 50; // Pukulan lurus
                this.attackBox.width = 80;
            } else if (type === 'kick') {
                this.attackBox.height = 30;
                this.attackBox.width = 120; // Tendangan lebih jauh
            }

            // Reset attack setelah 100ms (cepat)
            setTimeout(() => {
                this.isAttacking = false;
            }, 100); // Durasi frame animasi serangan
        }
    }

    // --- INISIALISASI ---
    const player = new Fighter({
        position: { x: 100, y: 0 },
        velocity: { x: 0, y: 0 },
        color: 'yellow' // Warna Player
    });

    const enemy = new Fighter({
        position: { x: 800, y: 0 },
        velocity: { x: 0, y: 0 },
        color: 'red', // Warna Musuh
        isEnemy: true
    });

    const keys = {
        ArrowRight: { pressed: false },
        ArrowLeft: { pressed: false }
    };

    // --- FUNGSI UTAMA ---
    
    // Deteksi Tabrakan (Collision Detection)
    function rectangularCollision({ rectangle1, rectangle2 }) {
        // Tentukan posisi X kotak serangan
        let attackX = rectangle1.facing === 1 
            ? rectangle1.position.x + rectangle1.width 
            : rectangle1.position.x - rectangle1.attackBox.width;

        return (
            attackX + rectangle1.attackBox.width >= rectangle2.position.x &&
            attackX <= rectangle2.position.x + rectangle2.width &&
            rectangle1.attackBox.position.y + rectangle1.attackBox.height >= rectangle2.position.y &&
            rectangle1.attackBox.position.y <= rectangle2.position.y + rectangle2.height
        );
    }

    // Logika AI Sederhana
    function updateAI() {
        if (gameState !== 'PLAY') return;

        const distance = player.position.x - enemy.position.x;
        const attackRange = 80;

        // Reset velocity
        enemy.velocity.x = 0;

        // 1. Gerakan (Mengejar Player)
        if (Math.abs(distance) > attackRange) {
            if (distance > 0) {
                enemy.velocity.x = 3; // Kejar ke kanan
                enemy.facing = 1;
            } else {
                enemy.velocity.x = -3; // Kejar ke kiri
                enemy.facing = -1;
            }
        } else {
            // 2. Serangan (Jika dekat)
            enemy.facing = distance > 0 ? 1 : -1; // Selalu hadap player
            
            // Random attack (chance 2% per frame biar gak spam gila)
            if (Math.random() < 0.02) {
                const type = Math.random() < 0.5 ? 'punch' : 'kick';
                enemy.attack(type);
            }
        }
    }

    function animate() {
        window.requestAnimationFrame(animate);
        
        // Bersihkan layar
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // --- MENU SCREEN ---
        if (gameState === 'MENU') {
            ctx.fillStyle = 'white';
            ctx.font = '50px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText("MORTAL PROTOTYPE", canvas.width/2, canvas.height/2 - 50);
            ctx.font = '24px Courier New';
            ctx.fillText("Tekan [SPASI] untuk FIGHT", canvas.width/2, canvas.height/2 + 20);
            ctx.fillText("Kontrol: Panah Kiri/Kanan = Jalan", canvas.width/2, canvas.height/2 + 70);
            ctx.fillText("Z = Pukul | X = Tendang", canvas.width/2, canvas.height/2 + 100);
            return;
        }

        // --- GAME OVER SCREEN ---
        if (gameState === 'GAMEOVER') {
            ctx.fillStyle = 'white';
            ctx.font = '50px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText(winner + " WINS!", canvas.width/2, canvas.height/2);
            ctx.font = '20px Courier New';
            ctx.fillText("Tekan Spasi untuk Restart", canvas.width/2, canvas.height/2 + 50);
            return;
        }

        // --- GAMEPLAY UPDATE ---
        player.update();
        enemy.update();
        updateAI(); // Jalankan otak musuh

        // Player Movement Logic
        player.velocity.x = 0;
        if (keys.ArrowLeft.pressed && player.lastKey === 'ArrowLeft') {
            player.velocity.x = -5; // Kecepatan jalan
            player.facing = -1;
        } else if (keys.ArrowRight.pressed && player.lastKey === 'ArrowRight') {
            player.velocity.x = 5;
            player.facing = 1;
        }

        // Deteksi Pukulan Player ke Enemy
        if (player.isAttacking && rectangularCollision({ rectangle1: player, rectangle2: enemy })) {
            player.isAttacking = false; // Reset biar hit cuma sekali
            enemy.health -= 5; // Damage Pukul
            if (player.attackType === 'kick') enemy.health -= 8; // Damage Tendang lebih besar
            document.querySelector('#enemy-fill').style.width = enemy.health + '%';
        }

        // Deteksi Pukulan Enemy ke Player
        if (enemy.isAttacking && rectangularCollision({ rectangle1: enemy, rectangle2: player })) {
            enemy.isAttacking = false;
            player.health -= 5;
            document.querySelector('#p1-fill').style.width = player.health + '%';
        }

        // Cek Mati
        if (enemy.health <= 0) {
            gameState = 'GAMEOVER';
            winner = 'PLAYER';
        } else if (player.health <= 0) {
            gameState = 'GAMEOVER';
            winner = 'AI BOT';
        }
    }

    animate();

    // --- INPUT CONTROLLER ---
    window.addEventListener('keydown', (event) => {
        if (gameState === 'MENU' || gameState === 'GAMEOVER') {
            if (event.code === 'Space') {
                // Reset Game
                player.health = 100;
                enemy.health = 100;
                player.position.x = 100;
                enemy.position.x = 800;
                document.querySelector('#p1-fill').style.width = '100%';
                document.querySelector('#enemy-fill').style.width = '100%';
                document.getElementById('ui-layer').style.display = 'flex';
                gameState = 'PLAY';
            }
        }

        // Kontrol Player
        if (gameState === 'PLAY') {
            switch (event.key) {
                case 'ArrowRight':
                    keys.ArrowRight.pressed = true;
                    player.lastKey = 'ArrowRight';
                    break;
                case 'ArrowLeft':
                    keys.ArrowLeft.pressed = true;
                    player.lastKey = 'ArrowLeft';
                    break;
                case 'z': // Pukul
                case 'Z':
                    player.attack('punch');
                    break;
                case 'x': // Tendang
                case 'X':
                    player.attack('kick');
                    break;
            }
        }
    });

    window.addEventListener('keyup', (event) => {
        switch (event.key) {
            case 'ArrowRight':
                keys.ArrowRight.pressed = false;
                break;
            case 'ArrowLeft':
                keys.ArrowLeft.pressed = false;
                break;
        }
    });

</script>
</body>
</html>